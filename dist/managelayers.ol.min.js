!function(t){var e={};function n(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(a,r,function(e){return t[e]}.bind(null,r));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=9)}([function(t,e){t.exports='<div class="m-control m-managelayers-{{baseName}}">\n\t<div id="toolbar-button-{{baseName}}" class="m-toolbar-button m-toolbar-button-{{baseName}}">\n\t\t<button id="tool-btn-{{baseName}}" class="m-tool-button {{iconClass}}" title="{{tooltip}}"></button>\n\t</div>\n\t<div id="toolbar-container-{{baseName}}" class="m-toolbar-container m-toolbar-container-{{baseName}} dNone" title="">\n\t\t<div id="tool-{{baseName}}" class="m-tool-container m-tool-container-{{baseName}}">\n\t\t</div>\n\t</div>\n</div>'},function(t,e,n){var a,r;function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}
/*! Sortable 1.7.0 - MIT | git://github.com/rubaxa/Sortable.git */!function(o){"use strict";void 0===(r="function"==typeof(a=function(){function t(e,n){if(!e||!e.nodeType||1!==e.nodeType)throw"Sortable: `el` must be HTMLElement, and not "+{}.toString.call(e);this.el=e,this.options=n=h({},n),e[H]=this;var a={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(e.nodeName)?"li":">*",ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==t.supportPointer};for(var i in a)!(i in n)&&(n[i]=a[i]);for(var o in lt(n),this)"_"===o.charAt(0)&&"function"==typeof this[o]&&(this[o]=this[o].bind(this));this.nativeDraggable=!n.forceFallback&&$,r(e,"mousedown",this._onTapStart),r(e,"touchstart",this._onTapStart),n.supportPointer&&r(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(r(e,"dragover",this),r(e,"dragenter",this)),it.push(this._onDragOver),n.store&&this.sort(n.store.get(this))}function e(t,e){"clone"!==t.lastPullMode&&(e=!0),O&&O.state!==e&&(s(O,"display",e?"none":""),e||O.state&&(t.options.group.revertClone?(S.insertBefore(O,C),t._animate(L,O)):S.insertBefore(O,L)),O.state=e)}function n(t,e,n){if(t){n=n||Z;do{if(">*"===e&&t.parentNode===n||g(t,e))return t}while(t=a(t))}return null}function a(t){var e=t.host;return e&&e.nodeType?e:t.parentNode}function r(t,e,n){t.addEventListener(e,n,K)}function o(t,e,n){t.removeEventListener(e,n,K)}function l(t,e,n){if(t)if(t.classList)t.classList[n?"add":"remove"](e);else{var a=(" "+t.className+" ").replace(V," ").replace(" "+e+" "," ");t.className=(a+(n?" "+e:"")).replace(V," ")}}function s(t,e,n){var a=t&&t.style;if(a){if(void 0===n)return Z.defaultView&&Z.defaultView.getComputedStyle?n=Z.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),void 0===e?n:n[e];e in a||(e="-webkit-"+e),a[e]=n+("string"==typeof n?"":"px")}}function c(t,e,n){if(t){var a=t.getElementsByTagName(e),r=0,i=a.length;if(n)for(;r<i;r++)n(a[r],r);return a}return[]}function u(t,e,n,a,r,i,o,l){t=t||e[H];var s=Z.createEvent("Event"),c=t.options,u="on"+n.charAt(0).toUpperCase()+n.substr(1);s.initEvent(n,!0,!0),s.to=r||e,s.from=i||e,s.item=a||e,s.clone=O,s.oldIndex=o,s.newIndex=l,e.dispatchEvent(s),c[u]&&c[u].call(t,s)}function p(t,e,n,a,r,i,o,l){var s,c,u=t[H],p=u.options.onMove;return(s=Z.createEvent("Event")).initEvent("move",!0,!0),s.to=e,s.from=t,s.dragged=n,s.draggedRect=a,s.related=r||e,s.relatedRect=i||e.getBoundingClientRect(),s.willInsertAfter=l,t.dispatchEvent(s),p&&(c=p.call(u,s,o)),c}function f(t){t.draggable=!1}function y(){et=!1}function d(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,a=0;n--;)a+=e.charCodeAt(n);return a.toString(36)}function m(t,e){var n=0;if(!t||!t.parentNode)return-1;for(;t&&(t=t.previousElementSibling);)"TEMPLATE"===t.nodeName.toUpperCase()||">*"!==e&&!g(t,e)||n++;return n}function g(t,e){if(t){var n=(e=e.split(".")).shift().toUpperCase(),a=new RegExp("\\s("+e.join("|")+")(?=\\s)","g");return!(""!==n&&t.nodeName.toUpperCase()!=n||e.length&&((" "+t.className+" ").match(a)||[]).length!=e.length)}return!1}function v(t,e){var n,a;return function(){void 0===n&&(n=arguments,a=this,z((function(){1===n.length?t.call(a,n[0]):t.apply(a,n),n=void 0}),e))}}function h(t,e){if(t&&e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function b(t){return J&&J.dom?J.dom(t).cloneNode(!0):Q?Q(t).clone(!0)[0]:t.cloneNode(!0)}function _(t){return z(t,0)}function M(t){return clearTimeout(t)}if("undefined"==typeof window||!window.document)return function(){throw new Error("Sortable.js requires a window with a document")};var L,w,E,O,S,C,N,T,k,P,x,A,I,R,j,D,B,W,q,U,F={},V=/\s+/g,G=/left|right|inline/,H="Sortable"+(new Date).getTime(),X=window,Z=X.document,Y=X.parseInt,z=X.setTimeout,Q=X.jQuery||X.Zepto,J=X.Polymer,K=!1,$="draggable"in Z.createElement("div"),tt=function(t){return!navigator.userAgent.match(/(?:Trident.*rv[ :]?11\.|msie)/i)&&((t=Z.createElement("x")).style.cssText="pointer-events:auto","auto"===t.style.pointerEvents)}(),et=!1,nt=Math.abs,at=Math.min,rt=[],it=[],ot=v((function(t,e,n){if(n&&e.scroll){var a,r,i,o,l,s,c=n[H],u=e.scrollSensitivity,p=e.scrollSpeed,f=t.clientX,y=t.clientY,d=window.innerWidth,m=window.innerHeight;if(k!==n&&(T=e.scroll,k=n,P=e.scrollFn,!0===T)){T=n;do{if(T.offsetWidth<T.scrollWidth||T.offsetHeight<T.scrollHeight)break}while(T=T.parentNode)}T&&(a=T,r=T.getBoundingClientRect(),i=(nt(r.right-f)<=u)-(nt(r.left-f)<=u),o=(nt(r.bottom-y)<=u)-(nt(r.top-y)<=u)),i||o||(o=(m-y<=u)-(y<=u),((i=(d-f<=u)-(f<=u))||o)&&(a=X)),F.vx===i&&F.vy===o&&F.el===a||(F.el=a,F.vx=i,F.vy=o,clearInterval(F.pid),a&&(F.pid=setInterval((function(){if(s=o?o*p:0,l=i?i*p:0,"function"==typeof P)return P.call(c,l,s,t);a===X?X.scrollTo(X.pageXOffset+l,X.pageYOffset+s):(a.scrollTop+=s,a.scrollLeft+=l)}),24)))}}),30),lt=function(t){function e(t,e){return void 0!==t&&!0!==t||(t=n.name),"function"==typeof t?t:function(n,a){var r=a.options.group.name;return e?t:t&&(t.join?t.indexOf(r)>-1:r==t)}}var n={},a=t.group;a&&"object"==i(a)||(a={name:a}),n.name=a.name,n.checkPull=e(a.pull,!0),n.checkPut=e(a.put),n.revertClone=a.revertClone,t.group=n};try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){K={capture:!1,passive:!1}}}))}catch(t){}return t.prototype={constructor:t,_onTapStart:function(t){var e,a=this,r=this.el,i=this.options,o=i.preventOnFilter,l=t.type,s=t.touches&&t.touches[0],c=(s||t).target,p=t.target.shadowRoot&&t.path&&t.path[0]||c,f=i.filter;if(function(t){rt.length=0;for(var e=t.getElementsByTagName("input"),n=e.length;n--;){var a=e[n];a.checked&&rt.push(a)}}(r),!L&&!(/mousedown|pointerdown/.test(l)&&0!==t.button||i.disabled)&&!p.isContentEditable&&(c=n(c,i.draggable,r))&&N!==c){if(e=m(c,i.draggable),"function"==typeof f){if(f.call(this,t,c,this))return u(a,p,"filter",c,r,r,e),void(o&&t.preventDefault())}else if(f&&(f=f.split(",").some((function(t){if(t=n(p,t.trim(),r))return u(a,t,"filter",c,r,r,e),!0}))))return void(o&&t.preventDefault());i.handle&&!n(p,i.handle,r)||this._prepareDragStart(t,s,c,e)}},_prepareDragStart:function(t,e,n,a){var i,o=this,s=o.el,p=o.options,y=s.ownerDocument;n&&!L&&n.parentNode===s&&(W=t,S=s,w=(L=n).parentNode,C=L.nextSibling,N=n,D=p.group,R=a,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,L.style["will-change"]="all",i=function(){o._disableDelayedDrag(),L.draggable=o.nativeDraggable,l(L,p.chosenClass,!0),o._triggerDragStart(t,e),u(o,S,"choose",L,S,S,R)},p.ignore.split(",").forEach((function(t){c(L,t.trim(),f)})),r(y,"mouseup",o._onDrop),r(y,"touchend",o._onDrop),r(y,"touchcancel",o._onDrop),r(y,"selectstart",o),p.supportPointer&&r(y,"pointercancel",o._onDrop),p.delay?(r(y,"mouseup",o._disableDelayedDrag),r(y,"touchend",o._disableDelayedDrag),r(y,"touchcancel",o._disableDelayedDrag),r(y,"mousemove",o._disableDelayedDrag),r(y,"touchmove",o._disableDelayedDrag),p.supportPointer&&r(y,"pointermove",o._disableDelayedDrag),o._dragStartTimer=z(i,p.delay)):i())},_disableDelayedDrag:function(){var t=this.el.ownerDocument;clearTimeout(this._dragStartTimer),o(t,"mouseup",this._disableDelayedDrag),o(t,"touchend",this._disableDelayedDrag),o(t,"touchcancel",this._disableDelayedDrag),o(t,"mousemove",this._disableDelayedDrag),o(t,"touchmove",this._disableDelayedDrag),o(t,"pointermove",this._disableDelayedDrag)},_triggerDragStart:function(t,e){(e=e||("touch"==t.pointerType?t:null))?(W={target:L,clientX:e.clientX,clientY:e.clientY},this._onDragStart(W,"touch")):this.nativeDraggable?(r(L,"dragend",this),r(S,"dragstart",this._onDragStart)):this._onDragStart(W,!0);try{Z.selection?_((function(){Z.selection.empty()})):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(){if(S&&L){var e=this.options;l(L,e.ghostClass,!0),l(L,e.dragClass,!1),t.active=this,u(this,S,"start",L,S,S,R)}else this._nulling()},_emulateDragOver:function(){if(q){if(this._lastX===q.clientX&&this._lastY===q.clientY)return;this._lastX=q.clientX,this._lastY=q.clientY,tt||s(E,"display","none");var t=Z.elementFromPoint(q.clientX,q.clientY),e=t,n=it.length;if(t&&t.shadowRoot&&(e=t=t.shadowRoot.elementFromPoint(q.clientX,q.clientY)),e)do{if(e[H]){for(;n--;)it[n]({clientX:q.clientX,clientY:q.clientY,target:t,rootEl:e});break}t=e}while(e=e.parentNode);tt||s(E,"display","")}},_onTouchMove:function(e){if(W){var n=this.options,a=n.fallbackTolerance,r=n.fallbackOffset,i=e.touches?e.touches[0]:e,o=i.clientX-W.clientX+r.x,l=i.clientY-W.clientY+r.y,c=e.touches?"translate3d("+o+"px,"+l+"px,0)":"translate("+o+"px,"+l+"px)";if(!t.active){if(a&&at(nt(i.clientX-this._lastX),nt(i.clientY-this._lastY))<a)return;this._dragStarted()}this._appendGhost(),U=!0,q=i,s(E,"webkitTransform",c),s(E,"mozTransform",c),s(E,"msTransform",c),s(E,"transform",c),e.preventDefault()}},_appendGhost:function(){if(!E){var t,e=L.getBoundingClientRect(),n=s(L),a=this.options;l(E=L.cloneNode(!0),a.ghostClass,!1),l(E,a.fallbackClass,!0),l(E,a.dragClass,!0),s(E,"top",e.top-Y(n.marginTop,10)),s(E,"left",e.left-Y(n.marginLeft,10)),s(E,"width",e.width),s(E,"height",e.height),s(E,"opacity","0.8"),s(E,"position","fixed"),s(E,"zIndex","100000"),s(E,"pointerEvents","none"),a.fallbackOnBody&&Z.body.appendChild(E)||S.appendChild(E),t=E.getBoundingClientRect(),s(E,"width",2*e.width-t.width),s(E,"height",2*e.height-t.height)}},_onDragStart:function(t,e){var n=this,a=t.dataTransfer,i=n.options;n._offUpEvents(),D.checkPull(n,n,L,t)&&((O=b(L)).draggable=!1,O.style["will-change"]="",s(O,"display","none"),l(O,n.options.chosenClass,!1),n._cloneId=_((function(){S.insertBefore(O,L),u(n,S,"clone",L)}))),l(L,i.dragClass,!0),e?("touch"===e?(r(Z,"touchmove",n._onTouchMove),r(Z,"touchend",n._onDrop),r(Z,"touchcancel",n._onDrop),i.supportPointer&&(r(Z,"pointermove",n._onTouchMove),r(Z,"pointerup",n._onDrop))):(r(Z,"mousemove",n._onTouchMove),r(Z,"mouseup",n._onDrop)),n._loopId=setInterval(n._emulateDragOver,50)):(a&&(a.effectAllowed="move",i.setData&&i.setData.call(n,a,L)),r(Z,"drop",n),n._dragStartId=_(n._dragStarted))},_onDragOver:function(a){var r,i,o,l,c=this.el,u=this.options,f=u.group,d=t.active,m=D===f,g=!1,v=u.sort;if(void 0!==a.preventDefault&&(a.preventDefault(),!u.dragoverBubble&&a.stopPropagation()),!L.animated&&(U=!0,d&&!u.disabled&&(m?v||(l=!S.contains(L)):B===this||(d.lastPullMode=D.checkPull(this,d,L,a))&&f.checkPut(this,d,L,a))&&(void 0===a.rootEl||a.rootEl===this.el))){if(ot(a,u,this.el),et)return;if(r=n(a.target,u.draggable,c),i=L.getBoundingClientRect(),B!==this&&(B=this,g=!0),l)return e(d,!0),w=S,void(O||C?S.insertBefore(L,O||C):v||S.appendChild(L));if(0===c.children.length||c.children[0]===E||c===a.target&&function(t,e){var n=t.lastElementChild.getBoundingClientRect();return e.clientY-(n.top+n.height)>5||e.clientX-(n.left+n.width)>5}(c,a)){if(0!==c.children.length&&c.children[0]!==E&&c===a.target&&(r=c.lastElementChild),r){if(r.animated)return;o=r.getBoundingClientRect()}e(d,m),!1!==p(S,c,L,i,r,o,a)&&(L.contains(c)||(c.appendChild(L),w=c),this._animate(i,L),r&&this._animate(o,r))}else if(r&&!r.animated&&r!==L&&void 0!==r.parentNode[H]){x!==r&&(x=r,A=s(r),I=s(r.parentNode));var h=(o=r.getBoundingClientRect()).right-o.left,b=o.bottom-o.top,_=G.test(A.cssFloat+A.display)||"flex"==I.display&&0===I["flex-direction"].indexOf("row"),M=r.offsetWidth>L.offsetWidth,N=r.offsetHeight>L.offsetHeight,T=(_?(a.clientX-o.left)/h:(a.clientY-o.top)/b)>.5,k=r.nextElementSibling,P=!1;if(_){var R=L.offsetTop,j=r.offsetTop;P=R===j?r.previousElementSibling===L&&!M||T&&M:r.previousElementSibling===L||L.previousElementSibling===r?(a.clientY-o.top)/b>.5:j>R}else g||(P=k!==L&&!N||T&&N);var W=p(S,c,L,i,r,o,a,P);!1!==W&&(1!==W&&-1!==W||(P=1===W),et=!0,z(y,30),e(d,m),L.contains(c)||(P&&!k?c.appendChild(L):r.parentNode.insertBefore(L,P?k:r)),w=L.parentNode,this._animate(i,L),this._animate(o,r))}}},_animate:function(t,e){var n=this.options.animation;if(n){var a=e.getBoundingClientRect();1===t.nodeType&&(t=t.getBoundingClientRect()),s(e,"transition","none"),s(e,"transform","translate3d("+(t.left-a.left)+"px,"+(t.top-a.top)+"px,0)"),e.offsetWidth,s(e,"transition","all "+n+"ms"),s(e,"transform","translate3d(0,0,0)"),clearTimeout(e.animated),e.animated=z((function(){s(e,"transition",""),s(e,"transform",""),e.animated=!1}),n)}},_offUpEvents:function(){var t=this.el.ownerDocument;o(Z,"touchmove",this._onTouchMove),o(Z,"pointermove",this._onTouchMove),o(t,"mouseup",this._onDrop),o(t,"touchend",this._onDrop),o(t,"pointerup",this._onDrop),o(t,"touchcancel",this._onDrop),o(t,"pointercancel",this._onDrop),o(t,"selectstart",this)},_onDrop:function(e){var n=this.el,a=this.options;clearInterval(this._loopId),clearInterval(F.pid),clearTimeout(this._dragStartTimer),M(this._cloneId),M(this._dragStartId),o(Z,"mouseover",this),o(Z,"mousemove",this._onTouchMove),this.nativeDraggable&&(o(Z,"drop",this),o(n,"dragstart",this._onDragStart)),this._offUpEvents(),e&&(U&&(e.preventDefault(),!a.dropBubble&&e.stopPropagation()),E&&E.parentNode&&E.parentNode.removeChild(E),S!==w&&"clone"===t.active.lastPullMode||O&&O.parentNode&&O.parentNode.removeChild(O),L&&(this.nativeDraggable&&o(L,"dragend",this),f(L),L.style["will-change"]="",l(L,this.options.ghostClass,!1),l(L,this.options.chosenClass,!1),u(this,S,"unchoose",L,w,S,R),S!==w?(j=m(L,a.draggable))>=0&&(u(null,w,"add",L,w,S,R,j),u(this,S,"remove",L,w,S,R,j),u(null,w,"sort",L,w,S,R,j),u(this,S,"sort",L,w,S,R,j)):L.nextSibling!==C&&(j=m(L,a.draggable))>=0&&(u(this,S,"update",L,w,S,R,j),u(this,S,"sort",L,w,S,R,j)),t.active&&(null!=j&&-1!==j||(j=R),u(this,S,"end",L,w,S,R,j),this.save()))),this._nulling()},_nulling:function(){S=L=w=E=C=O=N=T=k=W=q=U=j=x=A=B=D=t.active=null,rt.forEach((function(t){t.checked=!0})),rt.length=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragover":case"dragenter":L&&(this._onDragOver(t),function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.preventDefault()}(t));break;case"mouseover":this._onDrop(t);break;case"selectstart":t.preventDefault()}},toArray:function(){for(var t,e=[],a=this.el.children,r=0,i=a.length,o=this.options;r<i;r++)n(t=a[r],o.draggable,this.el)&&e.push(t.getAttribute(o.dataIdAttr)||d(t));return e},sort:function(t){var e={},a=this.el;this.toArray().forEach((function(t,r){var i=a.children[r];n(i,this.options.draggable,a)&&(e[t]=i)}),this),t.forEach((function(t){e[t]&&(a.removeChild(e[t]),a.appendChild(e[t]))}))},save:function(){var t=this.options.store;t&&t.set(this)},closest:function(t,e){return n(t,e||this.options.draggable,this.el)},option:function(t,e){var n=this.options;if(void 0===e)return n[t];n[t]=e,"group"===t&&lt(n)},destroy:function(){var t=this.el;t[H]=null,o(t,"mousedown",this._onTapStart),o(t,"touchstart",this._onTapStart),o(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(o(t,"dragover",this),o(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),(function(t){t.removeAttribute("draggable")})),it.splice(it.indexOf(this._onDragOver),1),this._onDrop(),this.el=t=null}},r(Z,"touchmove",(function(e){t.active&&e.preventDefault()})),t.utils={on:r,off:o,css:s,find:c,is:function(t,e){return!!n(t,e,t)},extend:h,throttle:v,closest:n,toggleClass:l,clone:b,index:m,nextTick:_,cancelNextTick:M},t.create=function(e,n){return new t(e,n)},t.version="1.7.0",t})?a.call(e,n,e,t):a)||(t.exports=r)}()},function(t,e){t.exports='<div id="tool-activelayers">\r\n\t<div id="toc-activelayers" class="m-toc-activelayers sortable-activelayers">\r\n\t\t{{#each overlayLayers}}\r\n\t\t<div id="tocLayer_{{id}}" data-id="{{id}}" class="toc-item-layer">\r\n\t\t\t<div id="titleTocLayer_{{id}}" class="toc-item-layer-header {{#if outOfRange}}out-of-range{{/if}}{{#if visible}} visible{{/if}}">\r\n\t\t\t\t<div class="m-area-accion-activelayers-collapse">\r\n\t\t\t\t\t<button data-id="{{id}}" class="m-accion-activelayers-collapse {{#if collapsed}}g-cartografia-flecha-abajo2{{else}}g-cartografia-flecha-arriba2{{/if}}"\r\n\t\t\t\t\t title="Opciones de capa"></button>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="m-area-title">\r\n\t\t\t\t\t<div id="textTitleLayer_{{id}}" title="{{title}}" class="m-title">{{groupTitle}} - {{title}}</div>\r\n\t\t\t\t\t{{#if canEditName}}\r\n\t\t\t\t\t<div class="m-button">\r\n\t\t\t\t\t\t<button data-id="{{id}}" class="m-accion-activelayers-rename g-cartografia-editar" title="Cambiar nombre"></button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{{/if}}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="m-area-activate" title="Activar/Desactivar capa">\r\n\t\t\t\t\t<input type="checkbox" data-id="{{id}}" class="m-accion-activelayers-activate" {{#if visible}} checked{{/if}}> </input>\r\n\t\t\t\t\t </div> <div class="m-area-origin">\r\n\t\t\t\t\t<span>{{origen}}</span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="m-area-order-hook" title="Orden de capas">\r\n\t\t\t\t\t<div class="m-accion-activelayers-order">\r\n\t\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">\r\n\t\t\t\t\t\t\t<path d="M25 0c-.254 0-.523.086-.719.281l-7 7a1.005 1.005 0 0 0-.218 1.094c.156.371.535.625.937.625h14.031c.551 0 1-.45 1-1a1.01 1.01 0 0 0-.437-.813L25.719.282A1.015 1.015 0 0 0 25 0zM2 13v4h46v-4zm0 10v4h46v-4zm0 10v4h46v-4zm16 8c-.402 0-.781.25-.938.625-.156.375-.066.809.22 1.094l7 7c.195.195.46.281.718.281.258 0 .523-.086.719-.281l7-7c.285-.285.375-.719.218-1.094A1.023 1.023 0 0 0 32 41z" />\r\n\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div id="optionsTocLayer_{{id}}" class="toc-item-layer-options{{#if collapsed}} dNone{{/if}}">\r\n\t\t\t\t<div class="layer-option-row">\r\n\t\t\t\t\t<div class="transparency-control">\r\n\t\t\t\t\t\t<input type="range" data-id="{{id}}" title="Nivel de transparencia" class="m-accion-activelayers-transparency"\r\n\t\t\t\t\t\t min="0" max="1" step="0.1" value="{{opacity}}" {{#unless visible}} disabled {{/unless}} {{#if outOfRange}}\r\n\t\t\t\t\t\t disabled{{/if}}/> <span class="transparency-percentage">{{opacityPer}}%</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{{#gt styles.length 1}}\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<button data-id="{{id}}" class="m-accion-activelayers-showstyles g-cartografia-lista" title="Estilos de la capa"></button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{{/gt}} {{#if metadata}}\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<button data-id="{{id}}" class="m-accion-activelayers-metadata g-cartografia-texto" title="Ver metadatos"></button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{{/if}} {{#if infoLayer}}\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<button data-id="{{id}}" class="m-accion-activelayers-info g-cartografia-info" title="Información de la capa"></button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{{/if}}\r\n\t\t\t\t\t{{#if canRemove}}\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\x3c!-- <span data-id="{{id}}" class="m-accion-activelayers-remove g-cartografia-papelera"></span> --\x3e\r\n\t\t\t\t\t\t<button data-id="{{id}}" class="m-accion-activelayers-remove g-cartografia-papelera" title="Eliminar capa"></button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{{/if}}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class="layer-option-row">\r\n\t\t\t\t\t<div class="legend">\r\n\t\t\t\t\t\t<h3>Leyenda</h3>\r\n\t\t\t\t\t\t<img data-id="{{id}}" src="{{legend}}"></img>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class="layer-option-row">\r\n\t\t\t\t\t<div id="stylesTocLayer_{{id}}" class="{{#unless showStyles}}dNone{{/unless}}">\r\n\t\t\t\t\t\t<h3>Estilos de capa</h3>\r\n\t\t\t\t\t\t{{#each styles}}\r\n\t\t\t\t\t\t<div class="m-accion-activelayers-styles">\r\n\t\t\t\t\t\t\t<input id="{{@index}}-{{id}}" data-id="{{id}}" type="radio" class="m-accion-activelayers-activestyle"\r\n\t\t\t\t\t\t\t {{#if selected}} checked{{/if}} name="{{id}}" value="{{@index}}" />\r\n\t\t\t\t\t\t\t<label for="{{@index}}-{{id}}">{{Title}}</label>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t{{/each}}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t{{else}}\r\n\t\t<div class="info">\r\n\t\t\t<span>No existe ninguna capa activa</span>\r\n\t\t</div>\r\n\t\t{{/each}}\r\n\t</div>\r\n</div>'},function(t,e){t.exports='<div id="tool-baselayers">\n\t<div id="toc-baselayers" class="m-toc-baselayers">\n\t\t{{#if baseMapBlanco}}\n\t\t<div id="{{baseMapBlanco.id}}" data-id="{{baseMapBlanco.id}}" class="box m-accion-baselayers-load {{#if activo}} baseActivo{{/if}}">\n\t\t\t<img data-id="{{baseMapBlanco.id}}" class="m-accion-baselayers-load">\n\t\t\t<div class="caption simple-caption">\n\t\t\t\t<h5 data-id="{{baseMapBlanco.id}}" class="m-accion-baselayers-load">Fondo Blanco</h5>\n\t\t\t</div>\n\t\t</div>\n\t\t{{/if}} {{#gt baseLayers.length 0}} {{#each baseLayers}}\n\t\t<div id="{{id}}" class="box{{#if activo}} baseActivo{{/if}}">\n\t\t\t<img data-id="{{id}}" class="m-accion-baselayers-load" src="{{img}}" alt="{{descripcion}}">\n\t\t\t<div class="caption simple-caption">\n\t\t\t\t<h5 data-id="{{id}}" class="m-accion-baselayers-load">{{title}}</h5>\n\t\t\t</div>\n\t\t</div>\n\t\t{{/each}} {{/gt}}\n\t</div>\n</div>'},function(t){t.exports=JSON.parse('{"url":{"name":"managelayers","separator":"*"},"constructor":"M.plugin.ManageLayers","parameters":[],"files":{"ol":{"scripts":["managelayers.ol.min.js"],"styles":["managelayers.ol.min.css"]}},"metadata":{"name":"ManageLayers","description":"TOC personalizable","text":"TOC personalizable con secciones para capas activas, de fondo y favoritas.","version":"1.0.0","date":"Abril, 2021","author":"","org":"Instituto de Estadística y Cartografía. Junta de Andalucía","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","centralized":false,"compatibility":["5","6"]}}')},function(t,e){t.exports='<div id="tool-thematiclayers">\n\t<div id="toc-thematiclayers" class="m-toc-thematiclayers">\n\t\t{{#gt groups.length 0}} {{#each groups}}\n\t\t<div id="tocGroup_{{id}}" data-id="{{id}}" class="toc-item-group">\n\t\t\t<div class="toc-item-group-header">\n\t\t\t\t<div class="layer-group-name">\n\t\t\t\t\t<button data-id="{{id}}" class="m-accion-thematiclayers-collapse {{#if collapsed}}g-cartografia-flecha-abajo2{{else}}g-cartografia-flecha-arriba2{{/if}}"\n\t\t\t\t\t title="Lista de capas"></button>\n\t\t\t\t\t<span>{{title}}</span>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- <div class="layer-group-button">\n\t\t\t\t\t<button data-id="{{id}}" class="m-accion-thematiclayers-load-group {{#if activated}}g-cartografia-cancelar2{{else}}g-cartografia-mas2{{/if}}"\n\t\t\t\t\t title="{{#if activated}}Eliminar todas las capas del grupo{{else}}Añadir todas las capas del grupo{{/if}}"></button>\n\t\t\t\t</div> --\x3e\n\t\t\t</div>\n\t\t\t<div id="optionsTocGroup_{{id}}" class="toc-item-group-options{{#if collapsed}} dNone{{/if}}">\n\t\t\t\t{{#gt overlays.length 0}} {{#each overlays}}\n\t\t\t\t<div class="toc-item-group-overlay">\n\t\t\t\t\t<input id="{{@index}}-{{id}}" class="m-accion-thematiclayers-load" type="checkbox" data-id="{{id}}" value="{{id}}" title="Añadir/Eliminar capa"\n\t\t\t\t\t {{#if load}}checked{{/if}}>\n\t\t\t\t\t<label for="{{@index}}-{{id}}">{{title}}</label>\n\t\t\t\t</div>\n\t\t\t\t{{/each}} {{/gt}}\n\t\t\t</div>\n\t\t</div>\n\t\t{{/each}} {{/gt}}\n\t</div>\n</div>'},function(t,e){t.exports='<div id="toolbar-managelayers" class="m-control m-toolbar m-control-toolbar-managelayers">\n\t\x3c!-- TOOLBARS BUTTONS --\x3e\n\t<div id="toolbar-buttons-managelayers" class="m-toolbar-buttons m-toolbar-buttons-managelayers"></div>\n\t\x3c!-- TITLE --\x3e\n\t<div id="toolbar-title-managelayers" class="title">Gestión de capas</div>\n\n\t<div id="toolbar-containers-managelayers" class="m-toolbar-containers m-toolbar-containers-managelayers">\n\t\t<div id="m-waiting-result" class="dNone m-waiting-result g-cartografia-spinner"></div>\n\t</div>\n</div>'},function(t,e){t.exports='<div id="tool-wmclayers">\n\t<div id="toc-wmclayers" class="m-toc-wmclayers">\n\t\t{{#gt wmcLayers.length 0}}\n\t\t<div class="toc-item-group-header">\n\t\t\t<div class="layer-group-name">\n\t\t\t\t<span>Capas WMC: {{name}}</span>\n\t\t\t</div>\n\t\t\t<div class="layer-group-button">\n\t\t\t\t\x3c!-- <button data-id="{{id}}" class="m-accion-thematiclayers-load-group {{#if activated}}g-cartografia-cancelar2{{else}}g-cartografia-mas2{{/if}}"\n\t\t\t\t title="{{#if activated}}Eliminar todas las capas del grupo{{else}}Añadir todas las capas del grupo{{/if}}"></button> --\x3e\n\t\t\t\t<button class="m-accion-wmclayers-load-group g-cartografia-mas2" title="Añadir todas las capas"></button>\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!-- <div class="title">\n\t\t\t<span>Capas WMC: {{name}}</span>\n\t\t\t<button class="m-accion-wmclayers-load-group g-cartografia-mas2" title="Añadir todas las capas"></button>\n\t\t</div> --\x3e\n\t\t{{#each wmcLayers}}\n\t\t<div id="wmclayer_{{id}}" class="toc-item-layer">\n\t\t\t<input id="{{@index}}-{{id}}" class="m-accion-wmclayers-load" type="checkbox" data-id="{{id}}" value="{{id}}" {{#if load}}checked{{/if}}\n\t\t\t title="Añadir/Eliminar capa">\n\t\t\t<label for="{{@index}}-{{id}}">{{title}}</label>\n\t\t</div>\n\t\t{{/each}} {{else}}\n\t\t<div class="info">\n\t\t\t<span>No se ha añadido ninguna capa WMC</span>\n\t\t</div>\n\t\t{{/gt}}\n\t</div>\n</div>'},function(t,e,n){},function(t,e,n){"use strict";function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function i(){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var a=o(t,e);if(a){var r=Object.getOwnPropertyDescriptor(a,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}}).apply(this,arguments)}function o(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=u(t);if(e){var r=u(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return c(this,n)}}function c(t,e){if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}n.r(e);var p=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}(c,M.impl.Control);var e,n,a,o=s(c);function c(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(e=o.call(this)).params_=t||{},e.facadeMap_=null,e}return e=c,(n=[{key:"addTo",value:function(t,e){this.facadeMap_=t,this.element=e,i(u(c.prototype),"addTo",this).call(this,t,e)}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"destroy",value:function(){this.deactivate(),this.element.remove(),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null,this.element=null}}])&&r(e.prototype,n),a&&r(e,a),Object.defineProperty(e,"prototype",{writable:!1}),c}(),f=n(0),y=n.n(f);function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function g(){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var a=v(t,e);if(a){var r=Object.getOwnPropertyDescriptor(a,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}}).apply(this,arguments)}function v(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=L(t)););return t}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function b(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=L(t);if(e){var r=L(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return _(this,n)}}function _(t,e){if(e&&("object"===d(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function L(t){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var w=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}(i,M.Control);var e,n,a,r=b(i);function i(t,e,n){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),M.utils.isUndefined(p)&&M.exception("La implementación usada no puede crear controles ManageLayersControl"),(a=r.call(this,t,n.controlName)).params_=e||{},a.options_=a.getControlOptions_(n),a}return e=i,a=[{key:"NAME",get:function(){return"ManageLayers"}},{key:"CONFIG_BASE",get:function(){return{controlName:i.NAME,template:y.a,iconClass:"g-cartografia-capas2",tooltip:"Gestor capas"}}}],(n=[{key:"createView",value:function(t){var e=this;return new Promise((function(t,n){var a=M.template.compileSync(e.options_.template,{vars:e.options_}),r=null;if(M.utils.isNullOrEmpty(e.options_.toolbar))r=a,e.getPanel()._controlsContainer.appendChild(a);else{var i=e.options_.toolbar;!1==!M.utils.isNullOrEmpty(e.getPanel()._element.querySelector(i.selector))&&e.getPanel()._controlsContainer.appendChild(i.target);var o=a.querySelector(e.getSelectorToolbarButton_()),l=a.querySelector(e.getSelectorToolbarContainer_());i.target.querySelector(i.selectorBtn).appendChild(o),i.target.querySelector(i.selectorContainer).appendChild(l),r=i.target}e.addEvents(r),t(r)}))}},{key:"activate",value:function(){this.getToolbarContainer_().classList.toggle("dNone"),this.getControlButton_().classList.toggle("active"),this.getTitleControlManageLayers_().innerText=this.options_.tooltip,g(L(i.prototype),"activate",this).call(this)}},{key:"deactivate",value:function(){this.getToolbarContainer_().classList.toggle("dNone"),this.getControlButton_().classList.toggle("active"),g(L(i.prototype),"deactivate",this).call(this)}},{key:"getControlOptions_",value:function(t){t=t||{};var e=M.utils.extend({},i.CONFIG_BASE,!0);return(e=M.utils.extend(e,t,!0)).baseName=M.utils.isNullOrEmpty(e.baseName)?e.controlName:e.baseName,e.baseName=e.baseName.toLowerCase(),e}},{key:"getConfigDefault_",value:function(){return this.CONFIG_BASE}},{key:"addEvents",value:function(t){}},{key:"render",value:function(){}},{key:"getActivationButton",value:function(t){return t.querySelector(this.getSelectorButton_())}},{key:"equals",value:function(t){var e=!1;return t instanceof i&&(e=this.name===t.name),e}},{key:"getSelectorToolbarButton_",value:function(){return"#toolbar-button-"+this.options_.baseName}},{key:"getSelectorToolbarContainer_",value:function(){return"#toolbar-container-"+this.options_.baseName}},{key:"getSelectorButton_",value:function(){return"#tool-btn-"+this.options_.baseName}},{key:"getSelectorContainer_",value:function(){return"#tool-"+this.options_.baseName}},{key:"getToolbarContainer_",value:function(){return this.getPanel()._element.querySelector(this.getSelectorToolbarContainer_())}},{key:"getControlContainer_",value:function(){return this.getPanel()._element.querySelector(this.getSelectorContainer_())}},{key:"getControlButton_",value:function(){return this.getPanel()._element.querySelector(this.getSelectorButton_())}},{key:"getTitleControlManageLayers_",value:function(){return this.getPanel()._element.querySelector("#toolbar-title-managelayers")}},{key:"getOptionsControlManageLayers",value:function(t){return this.getOptionsManageLayers(t,this.name.toLowerCase())}},{key:"setOptionsControlManageLayers",value:function(t,e){this.setOptionsManageLayers(t,e,this.name.toLowerCase())}},{key:"getOptionsManageLayers",value:function(t,e){var n=t.options.manageLayers;return M.utils.isNullOrEmpty(e)||M.utils.isNullOrEmpty(n)||(n=n[e]),n}},{key:"setOptionsManageLayers",value:function(t,e,n){M.utils.isNullOrEmpty(t.options.manageLayers)&&(t.options.manageLayers={}),M.utils.isNullOrEmpty(n)?t.options.manageLayers=e:t.options.manageLayers[n]=e}},{key:"resetOptionsManageLayers",value:function(t){t.options.manageLayers={}}},{key:"getQuerySelectorScapeCSS",value:function(t,e,n){return t.querySelector(e+CSS.escape(n))}},{key:"activateLoading",value:function(){this.getPanel()._element.querySelector("#m-waiting-result").classList.remove("dNone"),this.getPanel()._element.querySelector(".m-toolbar-containers-managelayers").style.minHeight="70px"}},{key:"deactivateLoading",value:function(){this.getPanel()._element.querySelector("#m-waiting-result").classList.add("dNone"),this.getPanel()._element.querySelector(".m-toolbar-containers-managelayers").style.minHeight="initial"}},{key:"addLayers",value:function(t){this.map_.addLayers(t)}},{key:"removeLayers",value:function(t){this.map_.getImpl().removeItemLayers(t)}},{key:"isLoadLayer",value:function(t){var e=!1;return null!=this.findLayerById(t.id)&&(e=!0),e}},{key:"findLayerByName",value:function(t){return this.findItemByProperty(this.map_.getLayers(),"name",t)}},{key:"findLayerById",value:function(t){return this.findItemByProperty(this.map_.getLayers(),"id",t)}},{key:"findItemByProperty",value:function(t,e,n){var a=null;return t&&e&&t.some((function(t){if(t[e]===n)return a=t,!0})),a}}])&&m(e.prototype,n),a&&m(e,a),Object.defineProperty(e,"prototype",{writable:!1}),i}();function E(t){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function S(t,e){return(S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function C(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=T(t);if(e){var r=T(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return N(this,n)}}function N(t,e){if(e&&("object"===E(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function T(t){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var k=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&S(t,e)}(i,M.impl.Control);var e,n,a,r=C(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=r.call(this)).params_=t||{},e.facadeMap_=null,e.totalActiveLayers_=0,e}return e=i,(n=[{key:"addTo",value:function(t,e){this.facadeMap_=t,this.element=e;var n=t.getMapImpl();ol.control.Control.call(this,{element:e,target:null}),n.addControl(this)}},{key:"activate",value:function(){this.registerEvents()}},{key:"deactivate",value:function(){this.unregisterEvents()}},{key:"destroy",value:function(){this.deactivate(),this.element.remove(),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null,this.element=null}},{key:"registerEvents",value:function(){var t=this;if(!M.utils.isNullOrEmpty(this.facadeMap_)){var e=this.facadeMap_.getMapImpl();this.registerViewEvents_(e.getView()),this.registerLayersEvents_(e.getLayers()),e.on("change:view",(function(e){return t.onViewChange_(e)}))}}},{key:"unregisterEvents",value:function(){var t=this;if(!M.utils.isNullOrEmpty(this.facadeMap_)){var e=this.facadeMap_.getMapImpl();this.unregisterViewEvents_(e.getView()),this.unregisterLayersEvents_(e.getLayers()),e.un("change:view",(function(e){return t.onViewChange_(e)}))}}},{key:"registerViewEvents_",value:function(t){var e=this;t.on("change:resolution",(function(){return e.renderPanel()}))}},{key:"registerLayersEvents_",value:function(t){var e=this;t.forEach((function(t){return e.registerLayerEvents_(t)})),t.on("remove",(function(){return e.renderPanel()})),t.on("add",(function(t){return e.onAddLayer_(t)}))}},{key:"registerLayerEvents_",value:function(t){var e=this;t.on("change:visible",(function(){return e.renderPanel()})),t.on("change:extent",(function(){return e.renderPanel()}))}},{key:"unregisterViewEvents_",value:function(t){var e=this;t.un("change:resolution",(function(){return e.renderPanel()}))}},{key:"unregisterLayersEvents_",value:function(t){var e=this;t.forEach((function(t){return e.registerLayerEvents_(t)})),t.un("remove",(function(){return e.renderPanel()})),t.un("add",(function(t){return e.onAddLayer_(t)}))}},{key:"unregisterLayerEvents_",value:function(t){var e=this;t.un("change:visible",(function(){return e.renderPanel()})),t.un("change:extent",(function(){return e.renderPanel()}))}},{key:"onViewChange_",value:function(t){this.unregisterViewEvents_(t.oldValue);var e=this.facadeMap_.getMapImpl();this.registerViewEvents_(e.getView())}},{key:"onAddLayer_",value:function(t){var e=t.element;this.registerLayerEvents_(e),e.setZIndex(this.totalActiveLayers_+1),this.renderPanel()}},{key:"renderPanel",value:function(t){this.facadeCtrol_.renderPanel()}},{key:"moveLayer",value:function(t,e,n){var a=this.getFilterLayerList(!1),r=n-e;if(r>0){for(var i=r;i>0;i--)a[n+1-i].setZIndex(a[n+1-i].getZIndex()+1);a[e].setZIndex(a[e].getZIndex()-r)}else{r*=-1;for(var o=1;o<=r;o++)a[n-1+o].setZIndex(a[n-1+o].getZIndex()-1);a[e].setZIndex(a[e].getZIndex()+r)}}},{key:"updateOrderLayer",value:function(t,e){t.setZIndex(e)}},{key:"getFilterLayerList",value:function(t){var e=this,n=this.facadeMap_.getLayers().filter((function(t){var n=!0===t.isBaseMap,a="__draw__"===t.name,r=!0===t.transparent,i=!0===t.displayInLayerSwitcher,o=t.type!==M.layer.type.WMC,l=!(t.type===M.layer.type.WMS&&M.utils.isNullOrEmpty(t.name));return n?e.updateOrderLayer(t,0):o&&!a&&(!1===r?e.updateOrderLayer(t,1):!1===i&&e.updateOrderLayer(t,2)),!n&&!a&&r&&o&&l&&i})).sort((function(e,n){var a=e.getZIndex(),r=n.getZIndex();if(isNaN(a)&&isNaN(r))return 0;if(isNaN(a))return-1;if(isNaN(r))return 1;var i=a-r;return t?i:-i})).map((function(e,n,a){return t?e.setZIndex(n+3):e.setZIndex(a.length+2-n),e}));return this.totalActiveLayers_=n.length,n}},{key:"setLayerStyle",value:function(t,e){t.getImpl().setSelectedStyle(e)}},{key:"getMetadataLink",value:function(t){return t.getImpl().getMetadataURL()}},{key:"getStylesLayer",value:function(t){return t.getImpl().getStylesLayer()}},{key:"getLayerStylePosition",value:function(t){return t.getImpl().selectedStyle_}}])&&O(e.prototype,n),a&&O(e,a),Object.defineProperty(e,"prototype",{writable:!1}),i}(),P=n(1),x=n.n(P),A=n(2),I=n.n(A);function R(t){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function j(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function D(t,e){return(D=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function B(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=U(t);if(e){var r=U(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return W(this,n)}}function W(t,e){if(e&&("object"===R(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return q(t)}function q(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function U(t){return(U=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var F=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&D(t,e)}(i,t);var e,n,a,r=B(i);function i(t,e){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),M.utils.isUndefined(k)&&M.exception("La implementación usada no puede crear controles ActiveLayersControl");var a={controlName:i.NAME,iconClass:"g-cartografia-capas2",tooltip:"Capas activas"};e=M.utils.extend(a,e,!0);var o=new k(t);return(n=r.call(this,o,t,e)).params_=t||{},o.facadeCtrol_=q(n),n.countID_=0,n.boundClickLayer_=function(t){return n.clickLayer(t)},n}return e=i,a=[{key:"NAME",get:function(){return"ActiveLayers"}},{key:"TEMPLATE",get:function(){return I.a}}],(n=[{key:"addEvents",value:function(t){var e=this;t.querySelector(this.getSelectorContainer_()).addEventListener("input",(function(t){return e.clickLayerSlider(t)}))}},{key:"clickLayerSlider",value:function(t){if(t=t||window.event,!M.utils.isNullOrEmpty(t.target)){var e=t.target,n=e.getAttribute("data-id");if(!M.utils.isNullOrEmpty(n)){var a=this.findLayerById(n);e.classList.contains("m-accion-activelayers-transparency")&&(a.setOpacity(parseFloat(e.value)),e.nextElementSibling.innerHTML=100*e.value+"%")}}}},{key:"clickLayer",value:function(t){if(t=t||window.event,!M.utils.isNullOrEmpty(t.target)){var e=t.target,n=e.getAttribute("data-id");if(!M.utils.isNullOrEmpty(n)){var a=this.findLayerById(n),r=this.getControlContainer_(),i=this.getQuerySelectorScapeCSS(r,"#optionsTocLayer_",n);if(e.classList.contains("m-accion-activelayers-collapse"))this.getOptionsControlManageLayers(a).collapsed=!i.classList.contains("dNone"),i.classList.toggle("dNone"),e.classList.toggle("g-cartografia-flecha-abajo2"),e.classList.toggle("g-cartografia-flecha-arriba2");else if(e.classList.contains("m-accion-activelayers-rename")){var o=this.getQuerySelectorScapeCSS(r,"#textTitleLayer_",n),l=document.createElement("input");l.type="text",l.value=o.innerText,o.innerText="",o.appendChild(l),l.addEventListener("focus",(function(){this.select()})),l.focus(),l.addEventListener("blur",(function(t){return function t(e){o.innerHTML=l.value,a.legend=l.value,l.removeEventListener("blur",(function(e){return t()})),l=null}()}))}else if(e.classList.contains("m-accion-activelayers-activate")){if(!0===a.transparent||!a.isVisible()){var s=e.parentElement.parentElement.querySelector("div.tools > input");M.utils.isNullOrEmpty(s)||a.setOpacity(s.value),a.setVisible(!a.isVisible())}}else if(e.classList.contains("m-accion-activelayers-metadata"))a.type!==M.layer.type.WMS&&a.type!==M.layer.type.WFS||this.getImpl().getMetadataLink(a).then((function(t){window.open(t,"_blank")}));else if(e.classList.contains("m-accion-activelayers-info"))a.getImpl().getAbstractLayer().then((function(t){var e="Información: "+a.legend;M.utils.isNullOrEmpty(t)&&(t="No hay descripción asociada a la capa"),M.dialog.info(t,e)}));else if(e.classList.contains("m-accion-activelayers-showstyles")){var c=this.getQuerySelectorScapeCSS(r,"#stylesTocLayer_",n);this.getOptionsControlManageLayers(a).showStyles=c.classList.contains("dNone"),c.classList.toggle("dNone")}else if(e.classList.contains("m-accion-activelayers-activestyle")){var u=e.value;u!=this.getImpl().getLayerStylePosition(a)&&(this.getImpl().setLayerStyle(a,u),this.renderPanel())}else e.classList.contains("m-accion-activelayers-remove")&&(this.resetOptionsManageLayers(a),this.removeLayers(a))}}}},{key:"moveLayer",value:function(t,e,n){var a=M.utils.isNullOrEmpty(t)?"":t.getAttribute("data-id");M.utils.isNullOrEmpty(a)||this.getImpl().moveLayer(a,e,n)}},{key:"render",value:function(){this.renderPanel()}},{key:"renderPanel",value:function(){var t=this;this.activateLoading(),this.getTemplateVariables_().then((function(e){var n={vars:{layersGroups:[{id:"GROUP_364",title:"Grupo 1",overlayLayers:[{metadata:!1,infoLayer:!0,origen:"Inicial",collapsed:!0,showStyles:!1,base:!1,visible:!0,id:"4_andalucia:01_Textos_Andalucia",name:"andalucia:01_Textos_Andalucia",title:"Textos Cartografía de Andalucia",legend:"https://www.ideandalucia.es/visor/leyendas/leyenda_Textos_Mapa_Andalucia.png",outOfRange:!1,opacity:1,opacityPer:100,styles:[],canEditName:!1,canRemove:!1},{metadata:!1,infoLayer:!0,origen:"Inicial",collapsed:!0,showStyles:!1,base:!1,visible:!0,id:"3_andalucia:01_Cartografia_Andalucia",name:"andalucia:01_Cartografia_Andalucia",title:"Cartografía de Andalucia",legend:"https://www.ideandalucia.es/visor/leyendas/leyenda_Cartografia_Mapa_Andalucia.png",outOfRange:!1,opacity:1,opacityPer:100,styles:[],canEditName:!1,canRemove:!1}]},{id:"GROUP_363",title:"Grupo 2",overlayLayers:[{metadata:!1,infoLayer:!0,origen:"Inicial",collapsed:!0,showStyles:!1,base:!1,visible:!0,id:"2_13_Textos_Cartografia_Contexto",name:"13_Textos_Cartografia_Contexto",title:"Textos Cartografía de Contexto",legend:"https://www.ideandalucia.es/visor/leyendas/leyenda_Textos_Contexto_Mapa_Andalucia.png",outOfRange:!1,opacity:1,opacityPer:100,styles:[],canEditName:!1,canRemove:!1},{metadata:!1,infoLayer:!0,origen:"Inicial",collapsed:!0,showStyles:!1,base:!1,visible:!0,id:"1_andalucia:13_Cartografia_Contexto",name:"andalucia:13_Cartografia_Contexto",title:"Cartografía de Contexto",legend:"https://www.ideandalucia.es/visor/leyendas/leyenda_Cartografia_Contexto_Mapa_Andalucia.png",outOfRange:!1,opacity:1,opacityPer:100,styles:[],canEditName:!1,canRemove:!1}]}],overlayLayers:[{groupId:"GROUP_364",groupTitle:"Grupo 1",metadata:!1,infoLayer:!0,origen:"Inicial",collapsed:!0,showStyles:!1,base:!1,visible:!0,id:"2_13_Textos_Cartografia_Contexto",name:"13_Textos_Cartografia_Contexto",title:"Textos Cartografía de Contexto",legend:"https://www.ideandalucia.es/visor/leyendas/leyenda_Textos_Contexto_Mapa_Andalucia.png",outOfRange:!1,opacity:1,opacityPer:100,styles:[],canEditName:!1,canRemove:!1},{groupId:"GROUP_363",groupTitle:"Grupo 2",metadata:!1,infoLayer:!0,origen:"Inicial",collapsed:!0,showStyles:!1,base:!1,visible:!0,id:"1_andalucia:13_Cartografia_Contexto",name:"andalucia:13_Cartografia_Contexto",title:"Cartografía de Contexto",legend:"https://www.ideandalucia.es/visor/leyendas/leyenda_Cartografia_Contexto_Mapa_Andalucia.png",outOfRange:!1,opacity:1,opacityPer:100,styles:[],canEditName:!1,canRemove:!1}]}},a=M.template.compileSync(i.TEMPLATE,n);console.log(n),t.sortableList&&(t.sortableList.destroy(),t.sortableList=null);var r=t.getControlContainer_().querySelectorAll("[class^=m-accion-]");if(Array.from(r).forEach((function(e){e.removeEventListener("click",t.boundClickLayer_)})),t.registerImgErrorEvents_(a),t.getControlContainer_().innerHTML=a.innerHTML,!t.sortableList){var o=t.getControlContainer_().querySelector(".sortable-activelayers");t.sortableList=x.a.create(o,{animation:150,handle:".m-accion-activelayers-order",onEnd:function(e){t.moveLayer(e.item,e.oldIndex,e.newIndex)}})}r=t.getControlContainer_().querySelectorAll("[class^=m-accion-]"),Array.from(r).forEach((function(e){e.addEventListener("click",t.boundClickLayer_)})),t.deactivateLoading()}))}},{key:"getTemplateVariables_",value:function(){var t=this;this.setConfigLayers();var e=this.getImpl().getFilterLayerList(!1).map((function(e){return t.parseLayerForTemplate_(e)}));return Promise.all(e).catch((function(t){return console.log("Catch",t)}))}},{key:"parseLayerForTemplate_",value:function(t,e){var n=this;return new Promise((function(a,r){var i=n.getOptionsControlManageLayers(t);M.utils.isNullOrEmpty(i)&&(i={index:e,collapsed:!0,showStyles:!1},n.setOptionsControlManageLayers(t,i));var o=t.legend;M.utils.isNullOrEmpty(o)&&(o=t.name),M.utils.isNullOrEmpty(o)&&(o="Servicio - "+t.type);var l=t.options.metadata,s=t.type===M.layer.type.WMS||t.type===M.layer.type.WMTS||t.type===M.layer.type.WFS,c=null,u=null,p=t.layerGroup_;null!=p&&(c=p.id,u=p.title);var f={groupId:c,groupTitle:u,metadata:!M.utils.isNullOrEmpty(l),infoLayer:s,origen:t.options.origen,collapsed:!0===i.collapsed,showStyles:!0===i.showStyles,base:!1===t.transparent,visible:!0===t.isVisible(),id:t.id,name:t.name,title:o,legend:t.getLegendURL(),outOfRange:!t.inRange(),opacity:t.getOpacity(),opacityPer:100*t.getOpacity(),styles:[],canEditName:"Inicial"!=t.options.origen&&"Tematica"!=t.options.origen,canRemove:"Inicial"!=t.options.origen},y=[];(t.type===M.layer.type.WMS||t.type===M.layer.type.WFS&&M.utils.isNullOrEmpty(l))&&y.push(n.getImpl().getMetadataLink(t).then((function(t){f.metadata=t})).catch((function(t){return console.log("Catch",t)}))),t.type===M.layer.type.WMS&&y.push(n.getImpl().getStylesLayer(t).then((function(e){var a=n.getImpl().getLayerStylePosition(t);f.styles=e.map((function(e,n){return e.id=t.id,e.selected=a==n,e})),f.legend=t.getLegendURL()})).catch((function(t){return console.log("Catch",t)}))),Promise.all(y).then((function(){a(f)})).catch((function(t){return console.log("Catch",t)}))}))}},{key:"registerImgErrorEvents_",value:function(t){var e=this,n=t.querySelectorAll("img");Array.prototype.forEach.call(n,(function(t){t.addEventListener("error",(function(t){var n=t.target.getAttribute("data-id"),a=e.findLayerById(n),r=M.utils.concatUrlPaths([M.config.THEME_URL,M.Layer.LEGEND_ERROR]);M.utils.isNullOrEmpty(a)||(a.setLegendURL(r),t.target.src=r)}))}))}},{key:"equals",value:function(t){var e=!1;return t instanceof i&&(e=this.name===t.name),e}},{key:"setConfigLayers",value:function(){var t=this;this.map_.getLayers().forEach((function(e,n){M.utils.isUndefined(e.options)&&(e.options={}),M.utils.isNullOrEmpty(e.id)&&(e.id=t.countID_+++"_"+e.name),M.utils.isNullOrEmpty(e.options.origen)&&(e.options.origen="Inicial"),M.utils.isNullOrEmpty(e.options.urlLegend)||e.setLegendURL(e.options.urlLegend)}))}}])&&j(e.prototype,n),a&&j(e,a),Object.defineProperty(e,"prototype",{writable:!1}),i}(w);function V(t){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function G(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function H(t,e){return(H=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function X(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Y(t);if(e){var r=Y(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Z(this,n)}}function Z(t,e){if(e&&("object"===V(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Y(t){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var z=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&H(t,e)}(i,M.impl.Control);var e,n,a,r=X(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=r.call(this)).params_=t||{},e.facadeMap_=null,e}return e=i,(n=[{key:"addTo",value:function(t,e){this.facadeMap_=t,this.element=e;var n=t.getMapImpl();ol.control.Control.call(this,{element:e,target:null}),n.addControl(this)}},{key:"destroy",value:function(){this.deactivate(),this.element.remove(),this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null,this.element=null}}])&&G(e.prototype,n),a&&G(e,a),Object.defineProperty(e,"prototype",{writable:!1}),i}(),Q=n(3),J=n.n(Q);function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $(t){return function(t){if(Array.isArray(t))return et(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||tt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(t,e){if(t){if("string"==typeof t)return et(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?et(t,e):void 0}}function et(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function nt(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function at(){return(at="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var a=rt(t,e);if(a){var r=Object.getOwnPropertyDescriptor(a,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}}).apply(this,arguments)}function rt(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=st(t)););return t}function it(t,e){return(it=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ot(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=st(t);if(e){var r=st(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return lt(this,n)}}function lt(t,e){if(e&&("object"===K(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function st(t){return(st=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ct=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&it(t,e)}(i,t);var e,n,a,r=ot(i);function i(t,e){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),M.utils.isUndefined(z)&&M.exception("La implementación usada no puede crear controles BaseLayersControl");var a={controlName:i.NAME,iconClass:"g-cartografia-localizacion",tooltip:"Mapas base"};e=M.utils.extend(a,e,!0);var o=new z;return(n=r.call(this,o,t,e)).params_=t||{},n.map_=null,n.baseMaps_=[],n.mapaActivo=null,n.activatedBlankMap=null,n}return e=i,a=[{key:"NAME",get:function(){return"BaseLayers"}},{key:"TEMPLATE",get:function(){return J.a}},{key:"BASEMAP_BLANCO",get:function(){return"base_blanco"}},{key:"IMG_BASEMAP_DEFAULT",get:function(){return"assets/img/default.png"}},{key:"IMG_BASEMAP_WHITE",get:function(){return"assets/img/osm.png"}}],(n=[{key:"addTo",value:function(t){at(st(i.prototype),"addTo",this).call(this,t),this.map_=t,this.baseMaps_=this.loadConfigInicial(),this.activatedBlankMap=!!M.utils.isNullOrEmpty(this.params_.activatedBlankMap)||this.params_.activatedBlankMap,M.utils.isNullOrEmpty(this.mapaActivo)&&this.activatedBlankMap&&(this.mapaActivo=i.BASEMAP_BLANCO),this.renderPanel()}},{key:"render",value:function(){}},{key:"renderPanel",value:function(){var t=this.getTemplateVariables_(),e=M.template.compileSync(i.TEMPLATE,{vars:t});this.getControlContainer_().innerHTML=e.innerHTML}},{key:"getTemplateVariables_",value:function(){var t={baseLayers:this.baseMaps_.map(this.parseLayerForTemplate_,this)};return this.activatedBlankMap&&(t.baseMapBlanco={id:i.BASEMAP_BLANCO,activo:i.BASEMAP_BLANCO==this.mapaActivo}),t}},{key:"parseLayerForTemplate_",value:function(t){var e=t.layer,n=e.legend;M.utils.isNullOrEmpty(n)&&(n=e.name),M.utils.isNullOrEmpty(n)&&(n="Mapa base");var a=e.options.descripcion;M.utils.isNullOrEmpty(a)&&(a="Imagen mapa base - "+n);var r=t.img,i=this.mapaActivo===t.id;return{id:t.id,title:n,descripcion:a,img:r,activo:i}}},{key:"addEvents",value:function(t){var e=this;t.querySelector(this.getSelectorContainer_()).addEventListener("click",(function(t){return e.clickBaseLayer(t)})),this.map_.on(M.evt.CHANGE_WMC,(function(){e.mapaActivo=null,e.baseMaps_=e.loadConfigInicial(),e.renderPanel()}))}},{key:"clickBaseLayer",value:function(t){var e=(t=t||window.event).target;if(!M.utils.isNullOrEmpty(e)&&e.classList.contains("m-accion-baselayers-load")){t.stopPropagation();var n=e.getAttribute("data-id");if(!M.utils.isNullOrEmpty(n)){var a=this.getControlContainer_().querySelector(".baseActivo"),r=a?a.getAttribute("id"):null;if(n!=r){this.getControlContainer_().querySelector("#"+n).classList.toggle("baseActivo");try{var i=this.findItemByProperty(this.baseMaps_,"id",n);i&&i.layer&&i.layer.getImpl().getOL3Layer().setVisible(!0)}catch(t){}try{r&&(a.classList.toggle("baseActivo"),this.findItemByProperty(this.baseMaps_,"id",r).layer.getImpl().getOL3Layer().setVisible(!1))}catch(t){}}}}}},{key:"loadConfigInicial",value:function(){var t=this,e=this.params_.baseMaps,n=!1,a=this.map_.getBaseLayers().map((function(t){return{img:"",layer:t}}));if(a.length){for(var r=0;r<a.length;r++)a[r].layer.isVisible()&&!n?(a[r].activo=!0,n=!0):a[r].activo=!1;var i,o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=tt(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var a=0,r=function(){};return{s:r,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){l=!0,i=t},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}(e);try{for(o.s();!(i=o.n()).done;)i.value.activo=!1}catch(t){o.e(t)}finally{o.f()}n||(a[0].layer.setVisible(!0),a[0].activo=!0,n=!0),e=[].concat($(e),$(a))}return M.utils.isNullOrEmpty(e)&&(e=[]),M.utils.isArray(e)||(e=[e]),e.map((function(e,a){var r;if(e.layer.setZIndex(0),e.id="base_"+a,!0===e.activo&&M.utils.isNullOrEmpty(t.mapaActivo)&&(t.mapaActivo=e.id,n||t.addLayers(e.layer)),M.utils.isNullOrEmpty(e.img)&&(e.img=t.getImgLayer(e.layer)),e.layer instanceof M.Layer)r=e.layer;else try{var i=M.parameter.layer(e.layer);M.utils.isNullOrEmpty(i.type)?M.dialog.error("No se ha especificado un tipo válido para la capa"):r=new M.layer[i.type](e.layer)}catch(t){M.dialog.error("El formato de la capa ("+e.layer+") no se reconoce")}return M.utils.isNullOrEmpty(r.id)&&(r.id=e.id),r.isbaseLayer=!0,r.transparent=!1,M.utils.isUndefined(r.options)&&(r.options={}),r.options.queryable=!1,e.layer=r,e}))}},{key:"equals",value:function(t){var e=!1;return t instanceof i&&(e=this.name===t.name),e}},{key:"getImgLayer",value:function(t){if(t.type===M.layer.type.WMS){var e=t.getLegendURL();return e||t.url+(t.url.indexOf("?")>-1?"&":"?")+"service=WMS&request=GetMap&layers="+t.name+"&bbox="+this.map_.getMaxExtent()+"&width=200&height=120&version=1.1.1&srs="+this.map_.getProjection().code+"&format=image/png"}return i.IMG_BASEMAP_DEFAULT}}])&&nt(e.prototype,n),a&&nt(e,a),Object.defineProperty(e,"prototype",{writable:!1}),i}(w),ut=(n(8),n(4));function pt(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var ft=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n,a;return e=t,a=[{key:"initMapeaCoreExtension",value:function(t){if(M.utils.isNullOrEmpty(t.fnEquals_)){t.fnEquals_=[],t.fnEquals_[M.layer.type.GeoJSON]=M.layer.GeoJSON.prototype.equals,t.fnEquals_[M.layer.type.KML]=M.layer.KML.prototype.equals,t.fnEquals_[M.layer.type.Mapbox]=M.layer.Mapbox.prototype.equals,t.fnEquals_[M.layer.type.OSM]=M.layer.OSM.prototype.equals,t.fnEquals_[M.layer.type.WFS]=M.layer.WFS.prototype.equals,t.fnEquals_[M.layer.type.WMC]=M.layer.WMC.prototype.equals,t.fnEquals_[M.layer.type.WMS]=M.layer.WMS.prototype.equals,t.fnEquals_[M.layer.type.WMTS]=M.layer.WMTS.prototype.equals;var e=t.fnEquals_,n=function(t){return M.utils.isUndefined(this.id)?e[this.type](t):this.id===t.id};M.layer.GeoJSON.prototype.equals=n,M.layer.KML.prototype.equals=n,M.layer.Mapbox.prototype.equals=n,M.layer.OSM.prototype.equals=n,M.layer.WFS.prototype.equals=n,M.layer.WMC.prototype.equals=n,M.layer.WMS.prototype.equals=n,M.layer.WMTS.prototype.equals=n}}},{key:"overrideMapeaCore",value:function(){M.impl.layer.WFS.prototype.getCapabilities=M.impl.layer.WMS.prototype.getCapabilities,M.impl.layer.WMS.prototype.getAbstractLayer=M.impl.layer.WFS.prototype.getAbstractLayer=M.impl.layer.WMTS.prototype.getAbstractLayer=function(){return new Promise(function(t,e){M.utils.isNullOrEmpty(this.abstract_)?this.getCapabilities().then(function(e){var n=null;M.utils.isUndefined(e.getInfoCapabilities)?!M.utils.isUndefined(e.Contents)&&e.Contents.Layer&&(n=e.Contents.Layer[0]):n=e.getInfoCapabilities(this.name),this.abstract_=n?n.Abstract:"",t(this.abstract_)}.bind(this)).catch((function(t){return e(t)})):t(this.abstract_)}.bind(this))},M.impl.layer.WMS.prototype.getMetadataURL=M.impl.layer.WFS.prototype.getMetadataURL=function(){var t=this;return new Promise((function(e,n){M.utils.isNullOrEmpty(t.metadataLink_)?t.getCapabilities().then((function(a){var r=null;t instanceof M.impl.layer.WMTS||(r=a.getInfoCapabilities(t.name)),t.metadataLink_=!!r&&!!r.MetadataURL&&r.MetadataURL[0].OnlineResource;var i=document.createElement("a");i.href=t.url,!t.metadataLink_&&["www.ideandalucia.es","www.callejerodeandalucia.es","www.juntadeandalucia.es"].indexOf(i.hostname)>-1?M.remote.get("http://www.ideandalucia.es/catalogo/inspire/srv/spa/q",{any:t.name},{jsonp:!0}).then((function(n){var a=(new DOMParser).parseFromString(n.text,"text/xml").getElementsByTagName("uuid");a.length&&(t.metadataLink_="http://www.ideandalucia.es/catalogo/inspire/srv/spa/metadata.formatter.html?xsl=metadato_completo&uuid="+a[0].childNodes[0].nodeValue),e(t.metadataLink_)})).catch((function(t){return n(t)})):e(t.metadataLink_)})).catch((function(t){return n(t)})):e(t.metadataLink_)}))},M.impl.layer.WMS.prototype.getStylesLayer=function(){var t=this;return new Promise((function(e,n){M.utils.isNullOrEmpty(t.listStyles_)?t.getCapabilities().then((function(n){var a=n.getInfoCapabilities(t.name);t.listStyles_=M.utils.isNullOrEmpty(a)||M.utils.isNullOrEmpty(a.Style)?[]:a.Style,t.selectedStyle_=0,M.utils.isNullOrEmpty(t.listStyles_[0])||M.utils.isNullOrEmpty(t.listStyles_[0].LegendURL)||t.setLegendURL(t.listStyles_[0].LegendURL[0].OnlineResource),t.listStyles_.forEach((function(e,n){e.Name==t.getOL3Layer().getSource().getParams().STYLES&&(t.selectedStyle_=n,M.utils.isNullOrEmpty(e.LegendURL)||t.setLegendURL(e.LegendURL[0].OnlineResource))})),e(t.listStyles_)})).catch((function(t){return n(t)})):e(t.listStyles_)}))},M.impl.layer.WMS.prototype.getSelectedStyle=function(){return M.utils.isNullOrEmpty(this.listStyles_)?null:this.listStyles_[this.selectedStyle_]},M.impl.layer.WMS.prototype.setSelectedStyle=function(t){if(!M.utils.isNullOrEmpty(this.listStyles_)){var e=this.listStyles_[t];this.getOL3Layer().getSource().updateParams({STYLES:e.Name}),this.selectedStyle_=t,M.utils.isNullOrEmpty(e.LegendURL)||this.setLegendURL(e.LegendURL[0].OnlineResource)}},M.impl.GetCapabilities.prototype.getInfoCapabilities=function(t){var e=null,n=null;for(e in this)if(!M.utils.isNullOrEmpty(this[e])&&!M.utils.isUndefined(this[e].Capability)){n=this[e].Capability;break}var a=null;return M.utils.isNullOrEmpty(n)||(a=this.getInfoCapabilitiesRecursive_(n.Layer,t)),a},M.impl.GetCapabilities.prototype.getInfoCapabilitiesRecursive_=function(t,e){var n,a,r=null;if(!M.utils.isNullOrEmpty(t))if(M.utils.isArray(t))for(n=0,a=t.length;n<a&&null===r;n++)r=this.getInfoCapabilitiesRecursive_(t[n],e);else M.utils.isObject(t)&&(M.utils.isNullOrEmpty(e)||t.Name===e?r=t:M.utils.isUndefined(t.Layer)||(r=this.getInfoCapabilitiesRecursive_(t.Layer,e)));return r},M.impl.Map.prototype.removeItemLayers=function(t){var e=this;return M.utils.isNullOrEmpty(t)&&(t=[]),M.utils.isArray(t)||(t=[t]),t.forEach((function(t){e.layers_=e.layers_.filter((function(e){return e!=t})),t.type!==M.layer.type.MBtiles&&t.type!==M.layer.type.WMC&&t.getImpl().destroy(),t.type==M.layer.type.KML&&!0===t.extract&&e.featuresHandler_.removeLayer(t.getImpl())})),this},M.impl.layer.OSM.prototype.destroy=function(){var t=this.map.getMapImpl();M.utils.isNullOrEmpty(this.ol3Layer)||(t.removeLayer(this.ol3Layer),this.ol3Layer=null),this.map.getLayers().forEach((function(t){(t instanceof M.layer.OSM||t instanceof M.layer.Mapbox)&&(this.haveOSMorMapboxLayer=!0)}),this),this.haveOSMorMapboxLayer||this.map.getImpl().getMapImpl().getControls().getArray().forEach((function(t){t instanceof ol.control.Attribution&&this.map.getImpl().getMapImpl().removeControl(t)}),this),this.map=null},M.impl.Layer.prototype.getLegendURL=function(){return M.utils.isNullOrEmpty(this.legendUrl_)&&(this.legendUrl_=M.utils.concatUrlPaths([M.config.THEME_URL,M.Layer.LEGEND_DEFAULT])),this.legendUrl_},M.impl.Layer.prototype.setLegendURL=function(t){this.legendUrl_=t},M.impl.Map.Z_INDEX={},M.impl.Map.Z_INDEX[M.layer.type.WMC]=1,M.impl.Map.Z_INDEX[M.layer.type.WMS]=1,M.impl.Map.Z_INDEX[M.layer.type.WMTS]=1,M.impl.Map.Z_INDEX[M.layer.type.Mapbox]=1,M.impl.Map.Z_INDEX[M.layer.type.OSM]=1,M.impl.Map.Z_INDEX[M.layer.type.KML]=1,M.impl.Map.Z_INDEX[M.layer.type.WFS]=1}}],(n=null)&&pt(e.prototype,n),a&&pt(e,a),Object.defineProperty(e,"prototype",{writable:!1}),t}(),yt=n(5),dt=n.n(yt);function mt(t){return(mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gt(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function vt(t,e){return(vt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ht(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=_t(t);if(e){var r=_t(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return bt(this,n)}}function bt(t,e){if(e&&("object"===mt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _t(t){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Mt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vt(t,e)}(i,t);var e,n,a,r=ht(i);function i(t,e){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var a=new p(t),o={controlName:i.NAME,iconClass:"g-cartografia-medir-area",tooltip:"Capas temáticas"};return e=M.utils.extend(o,e,!0),(n=r.call(this,a,t,e)).params_=t||{},n.thematicLayers_=[],n.loadConfigInicial(),n}return e=i,a=[{key:"NAME",get:function(){return"ThematicLayers"}},{key:"TEMPLATE",get:function(){return dt.a}}],(n=[{key:"equals",value:function(t){var e=!1;return t instanceof i&&(e=this.name===t.name),e}},{key:"render",value:function(){this.renderPanel()}},{key:"renderPanel",value:function(){var t=M.template.compileSync(i.TEMPLATE,{vars:this.getTemplateVariables_()});this.getControlContainer_().innerHTML=t.innerHTML}},{key:"addEvents",value:function(t){var e=this;t.querySelector(this.getSelectorContainer_()).addEventListener("click",(function(t){return e.clickThematicLayer(t)}))}},{key:"getTemplateVariables_",value:function(){return{groups:this.params_.groups.map(this.parseGroupForTemplate_,this)}}},{key:"parseGroupForTemplate_",value:function(t,e){var n=this.getOptionsControlManageLayers(t);return M.utils.isNullOrEmpty(n)&&(n={index:e,collapsed:!0,activated:!1},this.setOptionsControlManageLayers(t,n)),{id:t.id,title:t.title,collapsed:!0===n.collapsed,overlays:t.overlays.map(this.parseLayerForTemplate_,this),activated:!0===n.activated}}},{key:"parseLayerForTemplate_",value:function(t,e){var n=t.legend;return M.utils.isNullOrEmpty(n)&&(n=t.name),M.utils.isNullOrEmpty(n)&&(n="Servicio WMS"),{id:t.id,name:t.name,title:n,load:!0===this.isLoadLayer(t)}}},{key:"clickThematicLayer",value:function(t){if(t=t||window.event,!M.utils.isNullOrEmpty(t.target)){var e=t.target,n=e.getAttribute("data-id");if(!M.utils.isNullOrEmpty(n)){t.stopPropagation();var a=this.getControlContainer_(),r=this.getQuerySelectorScapeCSS(a,"#optionsTocGroup_",n);if(e.classList.contains("m-accion-thematiclayers-collapse")){var i=this.findItemByProperty(this.params_.groups,"id",n);this.getOptionsControlManageLayers(i).collapsed=!r.classList.contains("dNone"),e.classList.toggle("g-cartografia-flecha-abajo2"),e.classList.toggle("g-cartografia-flecha-arriba2"),r.classList.toggle("dNone")}else if(e.classList.contains("m-accion-thematiclayers-load-group")){var o=e.classList.contains("g-cartografia-mas2")?"input[type=checkbox]:not(:checked)":"input[type=checkbox]:checked";r.querySelectorAll(o).forEach((function(t,e){t.click()})),e.classList.toggle("g-cartografia-mas2"),e.classList.toggle("g-cartografia-cancelar2"),e.title=e.classList.contains("g-cartografia-mas2")?"Añadir todas las capas del grupo":"Eliminar todas las capas del grupo";var l=this.findItemByProperty(this.params_.groups,"id",n);this.getOptionsControlManageLayers(l).activated=!e.classList.contains("g-cartografia-mas2")}else if(e.classList.contains("m-accion-thematiclayers-load")){var s=this.findItemByProperty(this.thematicLayers_,"id",n);!0==!e.checked?this.removeLayers(s):this.addLayers(s)}}}}},{key:"loadConfigInicial",value:function(){var t=this,e=this.params_.groups;M.utils.isNullOrEmpty(e)&&(e=[]),M.utils.isArray(e)||(e=[e]),e.forEach((function(e,n){M.utils.isNullOrEmpty(e.id)&&(e.id="grp_thematic_"+n,e.index=n),M.utils.isNullOrEmpty(e.options)&&(e.options={}),M.utils.isNullOrEmpty(e.title)&&(e.title="Grupo - "+n),M.utils.isNullOrEmpty(e.overlays)&&(e.overlays=[]),e.overlays=t.loadConfigOverlays(e,e.overlays),t.thematicLayers_=t.thematicLayers_.concat(e.overlays)}),this),this.params_.groups=e}},{key:"loadConfigOverlays",value:function(t,e){return M.utils.isArray(e)||(e=[e]),e.map((function(e,n){var a;if(e instanceof M.Layer)a=e;else try{var r=M.parameter.layer(e);M.utils.isNullOrEmpty(r.type)?M.dialog.error("No se ha especificado un tipo válido para la capa"):a=new M.layer[r.type](e)}catch(t){M.dialog.error("El formato de la capa ("+e+") no se reconoce")}return M.utils.isNullOrEmpty(a.options)&&(a.options={}),a.options.isTematica=!0,a.options.origen="Tematica",M.utils.isNullOrEmpty(a.id)&&(a.id="thematic_"+t.index+"_"+n),a}))}}])&&gt(e.prototype,n),a&&gt(e,a),Object.defineProperty(e,"prototype",{writable:!1}),i}(w),Lt=n(6),wt=n.n(Lt);function Et(t){return(Et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ot(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function St(t,e){return(St=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ct(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=kt(t);if(e){var r=kt(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return Nt(this,n)}}function Nt(t,e){if(e&&("object"===Et(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Tt(t)}function Tt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function kt(t){return(kt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Pt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&St(t,e)}(i,M.Plugin);var e,n,a,r=Ct(i);function i(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),(e=r.call(this)).name=i.NAME,e.map_=null,e.controls_=[],t=t||{},e.config_=t.config||{},e.params_=t.params||{},e.metadata_=ut.metadata,e.options_=t.options||{},ft.overrideMapeaCore(),ft.initMapeaCoreExtension(Tt(e)),e}return e=i,a=[{key:"NAME",get:function(){return"ManageLayers"}},{key:"TEMPLATE",get:function(){return wt.a}}],(n=[{key:"addTo",value:function(t){var e=this;this.map_=t;var n=this.createView(t);this.toolbar_={target:n,selector:"#toolbar-"+i.NAME.toLowerCase(),selectorBtn:".m-toolbar-buttons",selectorContainer:".m-toolbar-containers"},this.map_.once(M.evt.COMPLETED,(function(){M.utils.isNullOrEmpty(e.params_.metadata)?e.initControls():M.remote.get(e.params_.metadata,null,{jsonp:!1}).then((function(t){!1===t.error||M.dialog.error("Se ha producido un error al cargar la configuración de metadatos","Configuración metadatos"),e.initControls()}))}))}},{key:"getConfigControl",value:function(t){var e=this.config_[t]||{};return e.params=e.params||{},e.options=e.options||{},e.options.toolbar=this.toolbar_,e}},{key:"initControls",value:function(){var t=this,e=null,n=null;n=this.getConfigControl("activeLayers"),e=new F(n.params,n.options),this.addControlToPlugin_(e),n=this.getConfigControl("baseLayers"),e=new ct(n.params,n.options),this.addControlToPlugin_(e),n=this.getConfigControl("thematicLayers"),e=new Mt(n.params,n.options),this.addControlToPlugin_(e),this.panel_=this.getPanel_(),this.panel_.addControls(this.controls_),this.panel_.on(M.evt.ADDED_TO_MAP,(function(){return t.fire(M.evt.ADDED_TO_MAP)})),this.map_.addPanels(this.panel_)}},{key:"createView",value:function(t){return M.template.compileSync||(M.template.compileSync=function(t,e){var n,a={};M.utils.isUndefined(e)||(a=M.utils.extends(a,e.vars),n=e.parseToHtml);var r=Handlebars.compile(t)(a);return!1!==n?M.utils.stringToHtml(r):r}),M.template.compileSync(i.TEMPLATE,{})}},{key:"addControlToPlugin_",value:function(t){t.on(M.evt.ACTIVATED,(function(){t.render()})),this.controls_.push(t)}},{key:"getPanel_",value:function(){var t=this,e=M.utils.isNullOrEmpty(this.options_.panel)||M.utils.isNullOrEmpty(this.options_.panel.name)?"managelayers":this.options_.panel.name,n=this.map_.getPanels(e)[0];return M.utils.isNullOrEmpty(n)&&((n=new M.ui.Panel(e,this.getPanelOptions_())).on(M.evt.ADDED_TO_MAP,(function(t){M.utils.enableTouchScroll(t)})),n.on(M.evt.SHOW,(function(e){for(var n=!1,a=t.getControls(),r=0;r<a.length;r++)if(a[r].activated){n=!0;break}n||t.map_.getControls(F.NAME)[0].activate()}))),n}},{key:"getPanelOptions_",value:function(){var t={};return M.utils.isNullOrEmpty(this.options_.panel)||(t=this.options_.panel),{collapsible:!0,className:"m-managelayers"+(M.utils.isNullOrEmpty(t.className)?"":" "+t.className),collapsedButtonClass:M.utils.isNullOrEmpty(t.collapsedClass)?"g-cartografia-capas2":t.collapsedClass,position:M.utils.isNullOrEmpty(t.position)?M.ui.position.TR:t.position,tooltip:M.utils.isNullOrEmpty(t.tooltip)?"Gestor de capas":t.tooltip}}},{key:"getControls",value:function(){return this.controls_}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_),this.map_=null,this.controls_=null,this.panel_=null,this.params_=null,this.options_=null,this.name=null}},{key:"equals",value:function(t){var e=!1;return t instanceof i&&(e=!0),e}},{key:"getMetadata",value:function(){return this.metadata_}}])&&Ot(e.prototype,n),a&&Ot(e,a),Object.defineProperty(e,"prototype",{writable:!1}),i}(),xt=n(7),At=n.n(xt);function It(t){return(It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Rt(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function jt(){return(jt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var a=Dt(t,e);if(a){var r=Object.getOwnPropertyDescriptor(a,e);return r.get?r.get.call(arguments.length<3?t:n):r.value}}).apply(this,arguments)}function Dt(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ut(t)););return t}function Bt(t,e){return(Bt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Wt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=Ut(t);if(e){var r=Ut(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return qt(this,n)}}function qt(t,e){if(e&&("object"===It(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ut(t){return(Ut=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ft=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Bt(t,e)}(i,t);var e,n,a,r=Wt(i);function i(t,e){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var a=new p(t),o={controlName:i.NAME,iconClass:"g-cartografia-capas",tooltip:"Capas WMC"};return e=M.utils.extend(o,e,!0),(n=r.call(this,a,t,e)).params_=t||{},n}return e=i,a=[{key:"NAME",get:function(){return"WMCLayers"}},{key:"TEMPLATE",get:function(){return At.a}}],(n=[{key:"addTo",value:function(t){var e=this;jt(Ut(i.prototype),"addTo",this).call(this,t),this.wmc_=this.getWMCSelected(),this.render(),this.map_.on(M.evt.CHANGE_WMC,(function(t){e.wmc_=e.getWMCSelected(),e.render()}),this)}},{key:"getWMCSelected",value:function(){var t=this.map_.getWMC().filter((function(t){return 1==t.selected})),e=t?t[0]:null;return e&&e.layers.forEach((function(t,e){M.utils.isNullOrEmpty(t.id)&&(t.id="WMC_"+e)})),e}},{key:"render",value:function(){this.renderPanel()}},{key:"renderPanel",value:function(){var t=M.template.compileSync(i.TEMPLATE,{vars:this.getTemplateVariables_()});this.getControlContainer_().innerHTML=t.innerHTML}},{key:"addEvents",value:function(t){var e=this;t.querySelector(this.getSelectorContainer_()).addEventListener("click",(function(t){return e.clickWmcLayer(t)}))}},{key:"getTemplateVariables_",value:function(){if(M.utils.isNullOrEmpty(this.wmc_))return{name:"",wmcLayers:[]};var t=this.wmc_.layers.filter((function(t){var e=t.type!==M.layer.type.WMC,n=!(t.type===M.layer.type.WMS&&M.utils.isNullOrEmpty(t.name));return e&&n&&!0}));return{name:this.wmc_.name,wmcLayers:t.map(this.parseLayerForTemplate_,this)}}},{key:"parseLayerForTemplate_",value:function(t){var e=t.legend;return M.utils.isNullOrEmpty(e)&&(e=t.name),M.utils.isNullOrEmpty(e)&&(e="Servicio WMS"),M.utils.isNullOrEmpty(t.options)&&(t.options={}),M.utils.isNullOrEmpty(t.options.origen)&&(t.options.isWMC=!0,t.options.origen="WMC"),{id:t.id,name:t.name,title:e,load:!0===this.isLoadLayer(t)}}},{key:"clickWmcLayer",value:function(t){var e=(t=t||window.event).target;if(!M.utils.isNullOrEmpty(e))if(e.classList.contains("m-accion-wmclayers-load-group")){t.stopPropagation();var n=e.classList.contains("g-cartografia-mas2")?"input[type=checkbox]:not(:checked)":"input[type=checkbox]:checked";this.getControlContainer_().querySelectorAll(n).forEach((function(t,e){t.click()})),e.classList.toggle("g-cartografia-mas2"),e.classList.toggle("g-cartografia-cancelar2"),e.title=e.classList.contains("g-cartografia-mas2")?"Añadir todas las capas":"Eliminar todas las capas"}else{var a=e.getAttribute("data-id");if(!M.utils.isNullOrEmpty(a)){t.stopPropagation();var r=this.findItemByProperty(this.wmc_.layers,"id",a);e.classList.contains("m-accion-wmclayers-load")&&(!0===this.isLoadLayer(r)?(this.removeLayers(r),this.resetOptionsManageLayers(r)):this.addLayers(r))}}}},{key:"equals",value:function(t){var e=!1;return t instanceof i&&(e=this.name===t.name),e}}])&&Rt(e.prototype,n),a&&Rt(e,a),Object.defineProperty(e,"prototype",{writable:!1}),i}(w);window.M.control||(window.M.control={}),window.M.plugin||(window.M.plugin={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.control.ActiveLayersControl=F,window.M.plugin.BaseLayersControl=ct,window.M.plugin.ManageLayers=Pt,window.M.control.ManageLayersControl=w,window.M.control.ThematicLayersControl=Mt,window.M.control.WMCLayersControl=Ft,window.M.impl.control.ActiveLayersControl=k,window.M.impl.control.BaseLayersControl=z,window.M.impl.control.ManageLayersControl=p}]);
//# sourceMappingURL=managelayers.ol.min.js.map